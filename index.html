<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Messmate App</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f9fbe7;
    color: #37472e;
    min-height: 100vh;
  }
  a {
    color: inherit;
    text-decoration: none;
  }
  button {
    cursor: pointer;
  }
  /* Login page */
  #login-page {
    display: flex;
    height: 100vh;
    justify-content: center;
    align-items: center;
    background: #f0f4c3;
  }
  #login-form {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    width: 320px;
  }
  #login-form h1 {
    text-align: center;
    color: #558b2f;
    margin-bottom: 1.5rem;
  }
  label {
    display: block;
    margin: 0.7rem 0 0.3rem 0;
    font-weight: 600;
  }
  input[type=text], input[type=password] {
    width: 100%;
    padding: 0.55rem;
    border-radius: 6px;
    border: 1.5px solid #9ccc65;
    font-size: 1rem;
  }
  input[type=text]:focus, input[type=password]:focus {
    border-color: #33691e;
    outline: none;
  }
  button#login-btn {
    margin-top: 1.4rem;
    background: #558b2f;
    border: none;
    color: white;
    width: 100%;
    font-weight: 700;
    padding: 0.6rem;
    border-radius: 6px;
    font-size: 1.1rem;
  }
  button#login-btn:hover {
    background: #33691e;
  }
  #login-error {
    color: #c62828;
    margin-top: 0.8rem;
    font-weight: 700;
    text-align: center;
    min-height: 1.2rem;
  }

  /* Main app layout */
  #app {
    display: none;
    height: 100vh;
  }
  /* Sidebar */
  #sidebar {
    position: fixed;
    top: 0; left: 0;
    width: 250px;
    height: 100%;
    background: #dcedc8;
    border-right: 1px solid #c5e1a5;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease;
    z-index: 1000;
  }
  #sidebar.hide {
    transform: translateX(-260px);
  }
  #sidebar h2 {
    margin: 1rem;
    font-size: 1.5rem;
    color: #33691e;
  }
  #sidebar nav {
    flex-grow: 1;
  }
  #sidebar nav a {
    display: block;
    padding: 1rem 1.2rem;
    border-bottom: 1px solid #c5e1a5;
    font-weight: 600;
    color: #558b2f;
  }
  #sidebar nav a.active, #sidebar nav a:hover {
    background: #c5e1a5;
    color: #33691e;
  }
  #sidebar footer {
    padding: 1rem;
    font-size: 0.85rem;
    color: #558b2f;
    border-top: 1px solid #c5e1a5;
    text-align: center;
  }

  /* Top bar with toggle */
  #topbar {
    background: #c5e1a5;
    height: 48px;
    display: flex;
    align-items: center;
    padding: 0 1rem;
    position: fixed;
    left: 0; right: 0;
    top: 0;
    z-index: 999;
  }
  #sidebarToggle {
    background: transparent;
    border: none;
    font-size: 1.5rem;
    color: #33691e;
    cursor: pointer;
  }
  #topbar h3 {
    flex-grow: 1;
    text-align: center;
    color: #33691e;
    margin: 0;
  }
  #logout-btn {
    background: transparent;
    border: none;
    color: #33691e;
    font-weight: 700;
    cursor: pointer;
  }

  /* Main content */
  #main-content {
    margin-left: 250px;
    margin-top: 48px;
    padding: 1rem 1.5rem 2rem 1.5rem;
    height: calc(100vh - 48px);
    overflow-y: auto;
  }
  #sidebar.hide + #main-content {
    margin-left: 0;
  }

  /* Pages */
  .page {
    display: none;
  }
  .page.active {
    display: block;
  }

  /* Dashboard Tabs */
  .tabs {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }
  .tabs button {
    background: #dcedc8;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-weight: 700;
    color: #558b2f;
  }
  .tabs button.active {
    background: #558b2f;
    color: white;
  }
  /* Tab content */
  .tab-content {
    background: white;
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 3px 8px rgba(0,0,0,0.05);
  }

  /* List styles */
  .list-item {
    border-bottom: 1px solid #ddd;
    padding: 0.6rem 0;
  }
  .list-item:last-child {
    border-bottom: none;
  }

  /* Forms */
  form label {
    font-weight: 600;
    display: block;
    margin: 0.4rem 0 0.2rem 0;
  }
  form input[type=text], form select, form textarea {
    width: 100%;
    padding: 0.5rem;
    border-radius: 6px;
    border: 1.5px solid #c5e1a5;
    font-size: 1rem;
    resize: vertical;
  }
  form textarea {
    min-height: 60px;
  }
  form button {
    margin-top: 1rem;
    background: #558b2f;
    color: white;
    border: none;
    padding: 0.6rem 1rem;
    border-radius: 6px;
    font-weight: 700;
    font-size: 1rem;
  }
  form button:hover {
    background: #33691e;
  }

  /* Votes */
  .votes {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.4rem;
  }
  .votes button {
    background: #c5e1a5;
    border: none;
    border-radius: 6px;
    padding: 0.2rem 0.6rem;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.2s ease;
  }
  .votes button:hover {
    background: #9ccc65;
  }
  .vote-count {
    font-weight: 700;
  }

  /* Responsive */
  @media (max-width: 768px) {
    #sidebar {
      transform: translateX(-260px);
      position: fixed;
      z-index: 1100;
    }
    #sidebar.show {
      transform: translateX(0);
    }
    #main-content {
      margin-left: 0;
      padding: 1rem;
    }
  }
</style>
</head>
<body>

<!-- Login Page -->
<div id="login-page">
  <form id="login-form">
    <h1>Messmate Login</h1>
    <label for="username">Username</label>
    <input id="username" type="text" required placeholder="Enter username" autocomplete="off" />
    <label for="password">Password</label>
    <input id="password" type="password" required placeholder="Enter password" autocomplete="off" />
    <button id="login-btn" type="submit">Login</button>
    <div id="login-error"></div>
  </form>
</div>

<!-- Main App -->
<div id="app">

  <!-- Sidebar -->
  <aside id="sidebar" class="hide" aria-label="Sidebar Navigation">
    <h2>Messmate</h2>
    <nav>
      <a href="#" data-page="dashboard" class="active">Dashboard</a>
      <a href="#" data-page="queries">Student Queries</a>
      <a href="#" data-page="suggestions">Menu Suggestions</a>
      <a href="#" class="inactive" data-page="settings">Settings</a>
      <a href="#" class="inactive" data-page="profile">Profile</a>
      <a href="#" class="inactive" data-page="virtual-nutritionist">Virtual Nutritionist AI</a>
    </nav>
    <footer>© 2025 Developer’s Club</footer>
  </aside>

  <!-- Topbar -->
  <header id="topbar">
    <button id="sidebarToggle" aria-label="Toggle Sidebar">☰</button>
    <h3>Messmate App</h3>
    <button id="logout-btn">Logout</button>
  </header>

  <!-- Main Content -->
  <main id="main-content">

    <!-- Dashboard Page -->
    <section id="dashboard" class="page active" tabindex="0" aria-label="Dashboard Page">
      <h2>Dashboard</h2>

      <div class="tabs" role="tablist" aria-label="Dashboard Tabs">
        <button class="tab-btn active" data-tab="daily-menu" role="tab" aria-selected="true" aria-controls="daily-menu" id="tab-daily-menu">Daily Menu</button>
        <button class="tab-btn" data-tab="complaints" role="tab" aria-selected="false" aria-controls="complaints" id="tab-complaints">Submit Complaint</button>
        <button class="tab-btn" data-tab="reviews" role="tab" aria-selected="false" aria-controls="reviews" id="tab-reviews">Add Review</button>
      </div>

      <div id="daily-menu" class="tab-content" role="tabpanel" aria-labelledby="tab-daily-menu">
        <h3>Today's Menu</h3>
        <ul id="menu-list">
          <!-- Daily menu items populated by JS -->
        </ul>
      </div>

      <div id="complaints" class="tab-content hidden" role="tabpanel" aria-labelledby="tab-complaints">
        <h3>Submit a Complaint</h3>
        <form id="complaint-form">
          <label for="complaint-meal">Meal</label>
          <select id="complaint-meal" required>
            <option value="" disabled selected>Select meal</option>
            <option value="Breakfast">Breakfast</option>
            <option value="Lunch">Lunch</option>
            <option value="Dinner">Dinner</option>
          </select>

          <label for="complaint-text">Complaint Details</label>
          <textarea id="complaint-text" placeholder="Describe your complaint" required></textarea>

          <label for="complaint-photo">Upload Photo (optional)</label>
          <input type="file" id="complaint-photo" accept="image/*" />

          <button type="submit">Submit Complaint</button>
        </form>
      </div>

      <div id="reviews" class="tab-content hidden" role="tabpanel" aria-labelledby="tab-reviews">
        <h3>Submit a Review</h3>
        <form id="review-form">
          <label for="review-meal">Meal</label>
          <select id="review-meal" required>
            <option value="" disabled selected>Select meal</option>
            <option value="Breakfast">Breakfast</option>
            <option value="Lunch">Lunch</option>
            <option value="Dinner">Dinner</option>
          </select>

          <label for="review-dish">Dish Name</label>
          <input id="review-dish" type="text" placeholder="Name of dish" required />

          <label for="review-rating">Rating</label>
          <select id="review-rating" required>
            <option value="" disabled selected>Select rating</option>
            <option value="5">5 - Excellent</option>
            <option value="4">4 - Good</option>
            <option value="3">3 - Average</option>
            <option value="2">2 - Poor</option>
            <option value="1">1 - Terrible</option>
          </select>

          <button type="submit">Submit Review</button>
        </form>
      </div>
    </section>

    <!-- Student Queries Page -->
    <section id="queries" class="page" tabindex="0" aria-label="Student Queries Page">
      <h2>Student Queries</h2>
      <div id="queries-list" style="max-height: 400px; overflow-y: auto; margin-bottom: 1rem; border: 1px solid #c5e1a5; border-radius: 10px; padding: 0.5rem; background: white;">
        <!-- Queries loaded by JS -->
      </div>

      <form id="query-submit-form">
        <label for="query-type">Query Type</label>
        <select id="query-type" required>
          <option value="" disabled selected>Select query type</option>
          <option value="Menu">Menu</option>
          <option value="Service">Service</option>
          <option value="Complaint">Complaint</option>
          <option value="Other">Other</option>
        </select>

        <label for="query-text">Your Query</label>
        <textarea id="query-text" placeholder="Ask your question here" required></textarea>

        <button type="submit">Submit Query</button>
      </form>
    </section>

    <!-- Menu Suggestions Page -->
    <section id="suggestions" class="page" tabindex="0" aria-label="Menu Suggestions Page">
      <h2>Menu Suggestions</h2>

      <form id="suggestion-form" style="margin-bottom:1rem;">
        <label for="suggestion-meal">Meal</label>
        <select id="suggestion-meal" required>
          <option value="" disabled selected>Select meal</option>
          <option value="Breakfast">Breakfast</option>
          <option value="Lunch">Lunch</option>
          <option value="Dinner">Dinner</option>
        </select>

        <label for="suggestion-day">Day</label>
        <select id="suggestion-day" required>
          <option value="" disabled selected>Select day</option>
          <option value="Monday">Monday</option>
          <option value="Tuesday">Tuesday</option>
          <option value="Wednesday">Wednesday</option>
          <option value="Thursday">Thursday</option>
          <option value="Friday">Friday</option>
          <option value="Saturday">Saturday</option>
          <option value="Sunday">Sunday</option>
        </select>

        <label for="suggestion-comments">Comments (optional)</label>
        <textarea id="suggestion-comments" placeholder="Your suggestion"></textarea>

        <button type="submit">Submit Suggestion</button>
      </form>

      <h3>Popular Suggestions</h3>
      <div id="suggestions-list" style="max-height: 400px; overflow-y: auto; border: 1px solid #c5e1a5; border-radius: 10px; background: white; padding: 0.5rem;">
        <!-- Suggestions loaded by JS -->
      </div>
    </section>

  </main>
</div>

<script>
  // Elements refs
  const loginPage = document.getElementById('login-page');
  const app = document.getElementById('app');
  const loginForm = document.getElementById('login-form');
  const loginError = document.getElementById('login-error');
  const sidebar = document.getElementById('sidebar');
  const sidebarToggle = document.getElementById('sidebarToggle');
  const logoutBtn = document.getElementById('logout-btn');
  const mainContent = document.getElementById('main-content');
  const navLinks = sidebar.querySelectorAll('nav a');
  const pages = document.querySelectorAll('.page');

  // Dashboard tabs
  const tabButtons = document.querySelectorAll('.tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');

  // Forms on dashboard
  const complaintForm = document.getElementById('complaint-form');
  const reviewForm = document.getElementById('review-form');

  // Queries page
  const queriesList = document.getElementById('queries-list');
  const querySubmitForm = document.getElementById('query-submit-form');

  // Suggestions page
  const suggestionForm = document.getElementById('suggestion-form');
  const suggestionsList = document.getElementById('suggestions-list');

  // Menu list on dashboard
  const menuList = document.getElementById('menu-list');

  // Allowed users
  const allowedUsers = {
    'jana': 'jana',
    'harrypotter': 'harrypotter'
  };

  // Sample daily menu (could be dynamic later)
  const dailyMenu = [
    'Breakfast: Idli, Sambar, Coconut Chutney',
    'Lunch: Rajma, Rice, Salad, Raita',
    'Dinner: Paneer Butter Masala, Chapati, Dal Tadka'
  ];

  // Storage keys
  const STORAGE_KEYS = {
    complaints: 'messmate_complaints',
    reviews: 'messmate_reviews',
    queries: 'messmate_queries',
    suggestions: 'messmate_suggestions',
  };

  // In-memory data containers
  let complaints = JSON.parse(localStorage.getItem(STORAGE_KEYS.complaints) || '[]');
  let reviews = JSON.parse(localStorage.getItem(STORAGE_KEYS.reviews) || '[]');
  let queries = JSON.parse(localStorage.getItem(STORAGE_KEYS.queries) || '[]');
  let suggestions = JSON.parse(localStorage.getItem(STORAGE_KEYS.suggestions) || '[]');

  // Save helpers
  function saveComplaints() {
    localStorage.setItem(STORAGE_KEYS.complaints, JSON.stringify(complaints));
  }
  function saveReviews() {
    localStorage.setItem(STORAGE_KEYS.reviews, JSON.stringify(reviews));
  }
  function saveQueries() {
    localStorage.setItem(STORAGE_KEYS.queries, JSON.stringify(queries));
  }
  function saveSuggestions() {
    localStorage.setItem(STORAGE_KEYS.suggestions, JSON.stringify(suggestions));
  }

  // Render daily menu
  function renderMenu() {
    menuList.innerHTML = '';
    dailyMenu.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      menuList.appendChild(li);
    });
  }

  // Show page helper
  function showPage(pageId) {
    pages.forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    // Mark active nav link
    navLinks.forEach(a => a.classList.remove('active'));
    [...navLinks].find(a => a.dataset.page === pageId)?.classList.add('active');
  }

  // Show dashboard tab
  function showTab(tabName) {
    tabButtons.forEach(btn => {
      btn.classList.toggle('active', btn.dataset.tab === tabName);
      btn.setAttribute('aria-selected', btn.dataset.tab === tabName);
    });
    tabContents.forEach(tc => {
      tc.classList.toggle('hidden', tc.id !== tabName);
    });
  }

  // Render queries
  function renderQueries() {
    queriesList.innerHTML = '';
    if (queries.length === 0) {
      queriesList.textContent = 'No queries submitted yet.';
      return;
    }
    queries.forEach((q, idx) => {
      const div = document.createElement('div');
      div.className = 'list-item';
      // Build status badges
      let statusBadge = '';
      if (q.answer) {
        statusBadge = q.verified ? '✅ Verified & Resolved' : '❌ Not Verified';
      } else {
        statusBadge = '⏳ Unanswered';
      }

      div.innerHTML = `<strong>Type:</strong> ${q.type} | <strong>Status:</strong> ${statusBadge}<br>
      <strong>Q:</strong> ${q.text}<br>
      ${q.answer ? `<strong>Answer:</strong> ${q.answer}` : ''}
      <br><small>By: ${q.answeredBy || 'N/A'}</small>
      `;
      queriesList.appendChild(div);
    });
  }

  // Render suggestions with votes
  function renderSuggestions() {
    suggestionsList.innerHTML = '';
    if (suggestions.length === 0) {
      suggestionsList.textContent = 'No suggestions yet.';
      return;
    }
    suggestions.forEach((sugg, idx) => {
      const div = document.createElement('div');
      div.className = 'list-item';
      div.style.marginBottom = '1rem';
      div.innerHTML = `
        <strong>${sugg.meal} - ${sugg.day}</strong><br>
        ${sugg.comments ? `<em>${sugg.comments}</em><br>` : ''}
        <div class="votes">
          <button aria-label="Upvote" data-idx="${idx}" data-type="upvote">👍</button>
          <span class="vote-count">${sugg.votes || 0}</span>
          <button aria-label="Downvote" data-idx="${idx}" data-type="downvote">👎</button>
        </div>
      `;
      suggestionsList.appendChild(div);
    });
  }

  // Upvote/downvote handler
  suggestionsList.addEventListener('click', e => {
    if (e.target.tagName !== 'BUTTON') return;
    const idx = e.target.dataset.idx;
    const type = e.target.dataset.type;
    if (idx == null) return;

    if (type === 'upvote') {
      suggestions[idx].votes = (suggestions[idx].votes || 0) + 1;
    } else if (type === 'downvote') {
      suggestions[idx].votes = (suggestions[idx].votes || 0) - 1;
    }
    saveSuggestions();
    renderSuggestions();
  });

  // Login handling
  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    const username = loginForm.username.value.trim().toLowerCase();
    const password = loginForm.password.value;

    if (allowedUsers[username] && allowedUsers[username] === password) {
      loginError.textContent = '';
      loginPage.style.display = 'none';
      app.style.display = 'flex';
      sidebar.classList.add('hide');
      showPage('dashboard');
      showTab('daily-menu');
      renderMenu();
      renderQueries();
      renderSuggestions();
      loginForm.reset();
      currentUser = username;
    } else {
      loginError.textContent = 'Invalid username or password.';
    }
  });

  // Sidebar toggle
  sidebarToggle.addEventListener('click', () => {
    if (window.innerWidth <= 768) {
      sidebar.classList.toggle('show');
    } else {
      sidebar.classList.toggle('hide');
    }
  });

  // Navigation clicks
  navLinks.forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      if (sidebar.classList.contains('show')) sidebar.classList.remove('show');
      const page = link.dataset.page;
      if (page) {
        showPage(page);
        if (page === 'dashboard') showTab('daily-menu');
      }
    });
  });

  // Logout
  logoutBtn.addEventListener('click', () => {
    if(confirm('Are you sure you want to logout?')) {
      app.style.display = 'none';
      loginPage.style.display = 'flex';
      currentUser = null;
    }
  });

  // Dashboard tab clicks
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      showTab(btn.dataset.tab);
    });
  });

  // Complaint form submit
  complaintForm.addEventListener('submit', e => {
    e.preventDefault();
    const meal = document.getElementById('complaint-meal').value;
    const details = document.getElementById('complaint-text').value.trim();
    const photoInput = document.getElementById('complaint-photo');

    let photoData = null;

    // Convert uploaded image to base64 string if present
    if(photoInput.files && photoInput.files[0]) {
      const reader = new FileReader();
      reader.onload = function(evt) {
        photoData = evt.target.result;
        complaints.push({ meal, details, photo: photoData, submittedBy: currentUser, date: new Date().toISOString() });
        saveComplaints();
        alert('Complaint submitted successfully!');
        complaintForm.reset();
      };
      reader.readAsDataURL(photoInput.files[0]);
    } else {
      complaints.push({ meal, details, photo: null, submittedBy: currentUser, date: new Date().toISOString() });
      saveComplaints();
      alert('Complaint submitted successfully!');
      complaintForm.reset();
    }
  });

  // Review form submit
  reviewForm.addEventListener('submit', e => {
    e.preventDefault();
    const meal = document.getElementById('review-meal').value;
    const rating = parseInt(document.getElementById('review-rating').value, 10);
    const comments = document.getElementById('review-comments').value.trim();

    if (!rating || rating < 1 || rating > 5) {
      alert('Please provide a valid rating between 1 and 5.');
      return;
    }

    reviews.push({ meal, rating, comments, submittedBy: currentUser, date: new Date().toISOString() });
    saveReviews();
    alert('Review submitted successfully!');
    reviewForm.reset();
  });

  // Query form submit
  querySubmitForm.addEventListener('submit', e => {
    e.preventDefault();
    const type = document.getElementById('query-type').value;
    const text = document.getElementById('query-text').value.trim();
    if (!text) {
      alert('Please enter a query.');
      return;
    }
    queries.push({ type, text, answer: null, verified: false, answeredBy: null, submittedBy: currentUser, date: new Date().toISOString() });
    saveQueries();
    renderQueries();
    alert('Query submitted successfully!');
    querySubmitForm.reset();
  });

  // Suggestion form submit
  suggestionForm.addEventListener('submit', e => {
    e.preventDefault();
    const day = document.getElementById('suggestion-day').value;
    const meal = document.getElementById('suggestion-meal').value;
    const comments = document.getElementById('suggestion-comments').value.trim();

    suggestions.push({ day, meal, comments, votes: 0, submittedBy: currentUser, date: new Date().toISOString() });
    saveSuggestions();
    renderSuggestions();
    alert('Suggestion submitted successfully!');
    suggestionForm.reset();
  });

  // Initialize
  let currentUser = null;
  app.style.display = 'none';
  loginPage.style.display = 'flex';
  showPage('login-page');

</script>
</body>
</html>
